name: Helm Template Run

on:
  pull_request:

permissions:
  contents: read
  pull-requests: write

jobs:
  helm-template:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: azure/setup-helm@v4
        with:
          version: v3.14.0

      - name: Helm template all charts
        run: |
          set -e

          GREEN='\033[0;32m'
          BLUE='\033[0;34m'
          YELLOW='\033[1;33m'
          RED='\033[0;31m'
          NC='\033[0m'

          for chart in charts/*; do
            if [ -f "$chart/Chart.yaml" ]; then
              chart_name=$(basename "$chart")

              echo "::group::Helm template - $chart_name"
              echo -e "${BLUE}==================================================${NC}"
              echo -e "${GREEN}ðŸš€ Helm Chart: ${chart_name}${NC}"
              echo -e "${BLUE}==================================================${NC}"

              echo -e "${YELLOW}â–¶ Template (default values)${NC}"
              helm template test "$chart"

              if [ -f "$chart/config/override-values.yaml" ]; then
                echo -e "${YELLOW}â–¶ Template (override-values.yaml)${NC}"
                helm template test "$chart" -f "$chart/config/override-values.yaml"
              else
                echo -e "${RED}âš  No override-values.yaml found${NC}"
              fi

              echo "::endgroup::"
            fi
          done
